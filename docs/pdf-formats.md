# Анализ форматов PDF лабораторий

> Последнее обновление: 2026-02-15
> Файлы: test_data/ (9 файлов, в .gitignore)

## Обзор файлов

| # | Лаборатория | Стр. | Тип анализа | ОАК? | Парсится? |
|---|------------|------|-------------|------|-----------|
| 1 | Гжельская лаба | 1 | Биохимия | Нет | Да |
| 2 | ДНКОМ | 1 | Биохимия | Нет | Да, отлично |
| 3 | Домодедовская больница | 1 | Глюкоза (1 показ.) | Нет | Да |
| 4 | LabQuest | 1 | ОАК + СОЭ + лейкоформула | **Да** | Да |
| 5 | Lab4U | 1 | ? | ? | **НЕТ (скан)** |
| 6 | Helix | 4 | Биохимия | Нет | Да (нестандартный) |
| 7 | Хромолаб | 2 | Гематология (ОАК) | **Да** | Да |
| 8 | Гемотест | 1 | Биохимия + Гормоны | Нет | Да |
| 9 | CMD (Настя) | 6 | ОАК + Щитовидная + Биохимия | **Да** | Да |

**Lab4U — за рамками MVP** (сканированный PDF, нужен OCR).

## Файлы с ОАК (фокус MVP)

Три файла: LabQuest, Хромолаб, CMD (Настя).

## Вариации заголовков колонок

| Лаборатория | Название | Результат | Единицы | Референсы |
|---|---|---|---|---|
| Гжельская | "Наименование"/"Название" | "Результат" | "Един.Измер" | "Референсн. Знач." |
| ДНКОМ | "Показатель" | "Результат" | "Ед. изм." | "Референсные значения" |
| Домодедовская | "Показатели" | "Результаты" | *(в результатах)* | "Норма" |
| LabQuest | "Параметр" | "Результат" | "Ед. изм." | "Референсные значения" |
| Helix | "Название/показатель" | "Результат" | *(нет отд.)* | "Референсные значения *" |
| Хромолаб | "Анализ" | "Результат" | "Ед. изм." | 3 колонки (Низкий/Норм/Высокий) |
| Гемотест | "Исследование" | "Значение" | "Ед. изм." | "Нормальные значения" |
| CMD (Настя) | "Параметр" | "Результат" | "Ед. изм." | "Референсные значения" |

**Ключевые слова для поиска колонки "Название":**
Наименование, Название, Показатель, Показатели, Параметр, Анализ, Исследование

**Ключевые слова для "Результат":**
Результат, Результаты, Значение

**Ключевые слова для "Единицы":**
Един, Изм, Ед.

## Данные пациента в шапке

| Лаборатория | Пол | Формат пола |
|---|---|---|
| Гжельская | `пол Муж.` | Сокращение с точкой |
| ДНКОМ | `Пол: М` | Одна буква |
| Домодедовская | `Пол: Женский` | Полное слово |
| LabQuest | `Пол: Ж` | Одна буква |
| Helix | `Женский` | Полное слово без метки |
| Хромолаб | `Пол: Ж` | Одна буква |
| Гемотест | `Пол пациента женский` | Полное слово в предложении |
| CMD (Настя) | `Пол: женский` | Полное слово, lowercase |

**Варианты для парсинга пола:**
- М, Муж, Муж., мужской, Мужской, male → male
- Ж, Жен, Жен., женский, Женский, female → female

## Формат чисел

**Десятичный разделитель - разнобой:**
- Точка: 52.80 (Гжельская), 4.97 (Гемотест), 143.00 (CMD)
- Запятая: 73,8 (ДНКОМ), 6,87 (LabQuest), 4,30 (Хромолаб)

**Нужна нормализация:** замена запятой на точку перед конвертацией в число.

## Специальные значения

| Тип | Примеры | Как обрабатывать |
|-----|---------|-----------------|
| Меньше порога | `< 2.5`, `< 1.0`, `<8.6` | Парсить число после `<` |
| Выше нормы | `3.3+` | Убрать `+`, парсить число |
| Стрелки | `▼`, `▲` | **Обрезать** |
| Текстовые референсы | "См. комментарий" | Игнорируем (не берём рефы из PDF) |

## Детальный анализ каждого файла

### 1. Гжельская лаба
- **Страниц:** 1
- **Тип:** Биохимия (16 показателей)
- **Шапка:** ФИО, дата рождения (как "возр."), пол (Муж.)
- **Колонки:** Наименование | Результат | Един.Измер | Референсн. Знач.
- **Числа:** точка (52.80)
- **Референсы:** М: 0-42 (с указанием пола!)
- **Единицы:** Е/л (не Ед/л!)
- **Проблемы:** двойной текстовый слой, pdfplumber не видит таблицу

### 2. ДНКОМ
- **Страниц:** 1
- **Тип:** Биохимия (23 показателя)
- **Шапка:** ФИО (CAPS), дата рождения + возраст, пол (М)
- **Колонки:** Показатель | Результат | Ед. изм. | Референсные значения
- **Числа:** запятая (73,8)
- **Таблица:** отлично парсится (24×4)
- **Названия:** полные + аббревиатура: "Аланинаминотрансфераза (АЛТ)"
- **Порядок слов:** "Общий белок" (vs "Белок общий" у Гжельской)
- **Единицы:** Ед/л

### 3. Домодедовская больница
- **Страниц:** 1
- **Тип:** 1 показатель (глюкоза)
- **Колонки:** Показатели | Результаты | Норма
- **ПРОБЛЕМА:** единицы ВНУТРИ ячеек результата и нормы ("6,96 ммоль/л")
- **Нет отдельной колонки единиц!**
- **Длинное название:** "Глюкоза, молярная концентрация в венозной крови"

### 4. LabQuest ⭐ (есть ОАК)
- **Страниц:** 1
- **Тип:** ОАК + СОЭ + лейкоцитарная формула
- **Шапка:** Пациент, дата рождения, возраст (35 л.), пол (Ж), ЛПУ
- **Колонки:** Параметр | Результат | Референсные значения | Ед. изм.
- **Числа:** запятая (6,87)
- **Показатели ОАК:** WBC, RBC, Hb, Ht, MCV, MCH, MCHC, RDW, PLT, MPV, СОЭ + лейкоформула (абс + %)
- **Проблемы:** 16 таблиц на странице, многострочные ячейки

### 5. Lab4U ❌ (НЕ MVP)
- **Сканированный PDF** (3 изображения, 0 символов)
- Нужен OCR, отложено

### 6. Helix
- **Страниц:** 4
- **Тип:** Биохимия
- **Нестандартный формат:** каждый показатель - отдельный блок с методом и оборудованием
- **Нет единой таблицы!**
- **Колонки:** Название/показатель | Результат | Референсные значения *
- **Стр. 3:** комментарии врача (текст)

### 7. Хромолаб ⭐ (есть ОАК)
- **Страниц:** 2
- **Тип:** Гематология (ОАК полный)
- **Шапка:** Пациент, возраст (40 л.), пол (Ж), **фаза цикла** (ЛЮТЕИНОВАЯ)
- **Колонки:** Анализ | Результат | Низкий | Нормальный уровень | Высокий | Ед. изм.
- **УНИКАЛЬНО:** 3 колонки референсов вместо одной!
- **Числа:** запятая (4,30)
- **Единицы:** 10*12/л, г/л, %, фл, пг, г/дл, 10*9/л
- **Многострочные ячейки:** да

### 8. Гемотест
- **Страниц:** 1
- **Тип:** Биохимия + Гормоны
- **Шапка:** ФИО (раздельно Фамилия/Имя), пол, дата рождения
- **Колонки:** Исследование | Значение | Ед. изм. | Нормальные значения
- **Группировка:** по разделам (БИОХИМИЧЕСКИЕ / ГОРМОНАЛЬНЫЕ)
- **Подгруппы:** Углеводный обмен, Щитовидная железа
- **Числа:** точка (4.97)
- **Специальные:** 3.3+ (знак повышения)
- **Коды приказов МЗ РФ** в таблице

### 9. CMD (Настя) ⭐ (есть ОАК)
- **Страниц:** 6
- **Тип:** ОАК + Щитовидная + Атеросклероз + Гормоны + Биохимия + Гликогемоглобин
- **Шапка:** Пациент, дата рождения, возраст (36 лет), пол (женский), **Беременность**, день цикла, ЛПУ
- **Колонки:** Параметр | Результат | Референсные значения | Ед. изм.
- **Числа:** точка (4.86, 143.00)
- **Группировка:** по видам анализов (каждый вид на отдельной странице/секции)
- **Специальные:** ▼ (пониженный), < 1.0, "См. комментарий"
- **Единицы:** 10⁹/л, 10¹²/л (суперскрипт!)
- **Референсы для беременных:** текстовые по триместрам

## Ключевые проблемы для универсального парсера

1. **8 разных форматов заголовков** — нужен гибкий поиск по ключевым словам
2. **Числа с точкой И запятой** — нормализация обязательна
3. **Многострочные ячейки** — слияние строк
4. **Единицы иногда внутри результата** (Домодедовская) — нужна экстракция
5. **Хромолаб: 3 колонки референсов** — нестандартная структура
6. **Helix: нет единой таблицы** — блочный формат
7. **Группировка по видам анализов** (Гемотест, CMD) — нужно определять секции
8. **Суперскрипт в единицах** (10⁹/л vs 10*9/л vs 109/л) — нормализация
